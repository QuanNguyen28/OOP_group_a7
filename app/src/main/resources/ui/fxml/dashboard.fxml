<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="app.controller.DashboardController">

    <top>
        <VBox spacing="8" styleClass="page">
            <HBox spacing="12">
                <Label text="Run:"/>
                <ComboBox fx:id="runSelector" prefWidth="220"/>

                <Separator orientation="VERTICAL"/>

                <Label text="From:"/>
                <DatePicker fx:id="fromDate"/>
                <Label text="To:"/>
                <DatePicker fx:id="toDate"/>

                <Separator orientation="VERTICAL"/>

                <Label text="Top N:"/>
                <Spinner fx:id="topNSpinner" prefWidth="90"/>

                <Button fx:id="btnRefresh" text="Refresh" styleClass="toolbar-btn"/>
                <Button fx:id="btnExport"  text="Export CSV" styleClass="toolbar-btn"/>
            </HBox>
            <Label fx:id="statusLabel" text="Ready"/>
        </VBox>
    </top>

    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE" styleClass="primary-tabs">
            <tabs>
                <!-- (1) Sentiment -->
                <Tab text="Sentiment">
                    <content>
                        <VBox spacing="10" styleClass="page">
                            <Label fx:id="overallSubtitle" text="Loading..."/>
                            <StackPane styleClass="card">
                                <LineChart fx:id="overallChart">
                                    <xAxis><CategoryAxis label="Day"/></xAxis>
                                    <yAxis><NumberAxis label="Posts"/></yAxis>
                                </LineChart>
                            </StackPane>

                            <TitledPane text="Insight (LLM)">
                                <VBox spacing="8" style="-fx-padding: 8;">
                                    <HBox spacing="8">
                                        <Button fx:id="btnSummarizeOverall" text="Summarize Sentiment"/>
                                        <Label text="(tự động dùng from/to nếu đặt)"/>
                                    </HBox>
                                    <TextArea fx:id="txtOverallSummary" prefRowCount="6" wrapText="true"/>
                                </VBox>
                            </TitledPane>
                        </VBox>
                    </content>
                </Tab>

                <!-- (2) Damage -->
                <Tab text="Damage">
                    <content>
                        <VBox spacing="10" styleClass="page">
                            <HBox spacing="8">
                                <Label text="View:"/>
                                <ComboBox fx:id="damageView" prefWidth="180"/>
                            </HBox>
                            <StackPane styleClass="card">
                                <BarChart fx:id="damageChart">
                                    <xAxis><CategoryAxis label="Type/Day"/></xAxis>
                                    <yAxis><NumberAxis label="Count"/></yAxis>
                                </BarChart>
                            </StackPane>

                            <TitledPane text="Insight (LLM)">
                                <VBox spacing="8" style="-fx-padding: 8;">
                                    <Button fx:id="btnSummarizeDamage" text="Summarize Damage"/>
                                    <TextArea fx:id="txtDamageSummary" prefRowCount="6" wrapText="true"/>
                                </VBox>
                            </TitledPane>
                        </VBox>
                    </content>
                </Tab>

                <!-- (3) Relief -->
                <Tab text="Relief">
                    <content>
                        <VBox spacing="10" styleClass="page">
                            <StackPane styleClass="card">
                                <PieChart fx:id="reliefPie"/>
                            </StackPane>

                            <TitledPane text="Insight (LLM)">
                                <VBox spacing="8" style="-fx-padding: 8;">
                                    <Button fx:id="btnSummarizeRelief" text="Summarize Relief"/>
                                    <TextArea fx:id="txtReliefSummary" prefRowCount="6" wrapText="true"/>
                                </VBox>
                            </TitledPane>
                        </VBox>
                    </content>
                </Tab>

                <!-- Task 3 -->
                <Tab text="Task 3: Satisfaction">
                    <content>
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <Label text="Mức độ hài lòng theo từng loại hàng cứu trợ" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                            <StackedBarChart fx:id="task3Chart">
                                <xAxis><CategoryAxis label="Loại hàng cứu trợ"/></xAxis>
                                <yAxis><NumberAxis label="Số bài viết"/></yAxis>
                            </StackedBarChart>

                            <TitledPane text="Insight (LLM)">
                                <VBox spacing="8" style="-fx-padding: 8;">
                                    <Button fx:id="btnSummarizeTask3" text="Summarize Task 3"/>
                                    <TextArea fx:id="txtTask3Summary" prefRowCount="6" wrapText="true"/>
                                </VBox>
                            </TitledPane>
                        </VBox>
                    </content>
                </Tab>

                <!-- Task 4 -->
                <Tab text="Task 4: Trends (per Category)">
                    <content>
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <Label text="Diễn biến tâm lý theo thời gian (trung bình)" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                            <LineChart fx:id="task4Chart">
                                <xAxis><CategoryAxis label="Ngày"/></xAxis>
                                <yAxis><NumberAxis label="Điểm (-1..1)" lowerBound="-1" upperBound="1" autoRanging="false"/></yAxis>
                            </LineChart>

                            <TitledPane text="Insight (LLM)">
                                <VBox spacing="8" style="-fx-padding: 8;">
                                    <HBox spacing="8">
                                        <Button fx:id="btnSummarizeTask4" text="Summarize Task 4 (use from/to)"/>
                                        <Label text="Sẽ dùng khoảng thời gian đang chọn ở header"/>
                                    </HBox>
                                    <TextArea fx:id="txtTask4Summary" prefRowCount="6" wrapText="true"/>
                                </VBox>
                            </TitledPane>
                        </VBox>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>
</BorderPane>